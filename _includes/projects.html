<div class="projects">
{% assign categories = "" | split:"," %}
{% assign pages = site.pages | where:"layout", 'project' | where:"lang", page.lang %}
{% for p in pages %}
  {% for category in p.categories %}
    {% assign slugifiedCategory = category | slugify %}
    {% assign categories = categories | push: slugifiedCategory | uniq %}
  {% endfor %}
{% endfor %}
<style>
{% for category in categories %}
  #{{ category }}:target ~ :not([categories~="{{ category }}"]) { display: none; }
{% endfor %}
</style>
{% for category in categories %}
<span id="{{category}}" style="display: none;"></span>
{% endfor %}
{% for p in pages %}
  {% assign categories = "" | split:"," %}
  {% for category in p.categories %}
    {% assign slugifiedCategory = category | slugify %}
    {% assign categories = categories | push: slugifiedCategory | uniq %}
  {% endfor %}
  {% assign pathref = p.ref | append: '/' | prepend: '/' %}
  {% assign image_files = site.static_files | where_exp: "item", "item.path contains pathref" %}
  {% for image in image_files %}
    {% if image.basename contains "conceptschets" %}
      {% assign conceptschets = image %}
    {% else if image.basename contains "main" %}
      {% assign main = image %}
    {% endif %}
  {% endfor %}
  <div class="project{% if p.highlight %} highlight{% endif %}" categories="{{ categories | join: ' ' }}">
    <a href="#{{ p.title | slugify }}" style="background-image: url({{ main.path }});">
      <span class="project-concept" style="background-image: url({{ conceptschets.path }});">
        <span class="project-title">{{ p.title }}</span>
      </span>
    </a>
    <a href="javascript: history.back();" id="{{ p.title | slugify }}" class="project-content">
      {% for image in image_files %}
        {% unless image.basename contains "conceptschets" or image.basename contains "main" %}
        <img src="{{ image.path }}" alt="{{ page.title }} {{ image.basename }}" title="{{ page.title }} {{ image.basename }}" />
        {% endunless %}
      {% endfor %}      
    </a>
  </div>
{% endfor %}
</div>